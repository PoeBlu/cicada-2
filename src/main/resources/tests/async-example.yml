description: Receive PO load test
tests:
  - name: Delete purchase orders
    clients:
      - type: SQLClient
        settings: # NOTE: jinja expand settings
          url: ${ssm(wf.dbURL)}
          username: ${ssm(wf.dbUser)}
          password: ${ssm(wf.dbPass)}
        actions:
          - query: "delete from web_document where appkey1='ENGINELOADTEST'"
  - name: Send 1 purchase orders
    clients:
      - type: JMSClient
        settings:
          url: "{{ jms['queueURL'] }}"
          user: "{{ jms['queueUser'] }}"
          pass: ${ssm(jms.queuePass)}
          connectionFactory: QueueConnectionFactory
          initalContextFactory: weblogic.jndi.WLInitialContextFactory
        actions:
          - type: SendMessage
            queueName: jms/WEBFORMS
            headers:
              MessageType: DOCUMENT
              draft: "false"
              BPELCorrelationId: "-1"
              JMSCorrelationId: "-1"
              DataCenterDocumentKey: "10837902237"
  - name: Wait indefinitely for message
    clients:
      - type: JMSClient
        settings:
          url: "{{ jms['queueURL'] }}"
          user: "{{ jms['queueUser'] }}"
          pass: ${ssm(jms.queuePass)}
          connectionFactory: QueueConnectionFactory
          initalContextFactory: weblogic.jndi.WLInitialContextFactory
        actions:
          - type: ReceiveMessage
            queueName: jms/QaTool
    asserts:
      - type: HeaderAssert
        parameters: "{{DataCenterDocumentKey: '10837902237'}}"
  - name: Check that doc was created
    clients:
      - type: SQLClient
        settings:
          url: ${ssm(wf.dbURL)}
          username: ${ssm(wf.dbUser)}
          password: ${ssm(wf.dbPass)}
        actions:
          - query: "select count(*) from web_document d where d.appkey1='ENGINELOADTEST'"
    asserts:
      - type: TableAssert
        parameters:
          - row1:
            - column1: "1"
